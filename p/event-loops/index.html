<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Event loops, asynchronous and relevant concepts"><title>Event Loops</title>
<link rel=canonical href=https://sonlhcsuit.github.io/p/event-loops/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Event Loops">
<meta property="og:description" content="Event loops, asynchronous and relevant concepts">
<meta property="og:url" content="https://sonlhcsuit.github.io/p/event-loops/">
<meta property="og:site_name" content="Sơn Lưu Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="event"><meta property="article:published_time" content="2021-04-23T09:02:11+07:00"><meta property="article:modified_time" content="2021-04-23T09:02:11+07:00"><meta property="og:image" content="https://sonlhcsuit.github.io/p/event-loops/cover.png">
<meta name=twitter:title content="Event Loops">
<meta name=twitter:description content="Event loops, asynchronous and relevant concepts"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://sonlhcsuit.github.io/p/event-loops/cover.png">
</head>
<body>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"light")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<img src=/img/rayquaza-chibi_hu34a7b96c7941009c408806c7f93294af_18254_300x0_resize_box_3.png width=300 height=290 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>💞</span>
</figure>
<h1 class=site-name><a href=https://sonlhcsuit.github.io>Sơn Lưu Blog</a></h1>
<h2 class=site-description>In love w/ Ms.Sophie</h2>
</header>
<ol class=menu id=main-menu>
<li>
<a href=/><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512"><polygon style="fill:#e9eaef" points="452.441,209.325 452.441,508.793 59.559,508.793 59.559,209.325 257.108,17.691"/><path style="fill:#9eb1b7" d="M454.531 62.672V197.13l-66.873-63.687-31.347-29.853V62.672c0-7.952 6.446-14.398 14.398-14.398h69.425C448.085 48.273 454.531 54.72 454.531 62.672z"/><path style="fill:#879ba0" d="M387.657 48.273v85.17L356.31 103.59V62.672c0-7.952 6.446-14.398 14.398-14.398h16.949V48.273z"/><g><path style="fill:#9cce21" d="M512 462.669v46.122H274.808v-46.122c0-9.185 7.45-16.624 16.635-16.624h203.922C504.55 446.045 512 453.485 512 462.669z"/><path style="fill:#9cce21" d="M83.143 462.669v46.122H0v-46.122c0-9.185 7.44-16.624 16.624-16.624h49.883C75.703 446.045 83.143 453.485 83.143 462.669z"/></g><g><path style="fill:#85c10d" d="M512 478.343v30.448H274.808v-30.448c0-9.185 7.45-16.624 16.635-16.624h203.922C504.55 461.718 512 469.158 512 478.343z"/><path style="fill:#85c10d" d="M83.143 478.343v30.448H0v-30.448c0-9.185 7.44-16.624 16.624-16.624h49.883C75.703 461.718 83.143 469.158 83.143 478.343z"/></g><polygon style="fill:#d2d4d8" points="452.441,221.081 452.441,277.056 256,89.497 59.559,277.056 59.559,221.081 240.4,48.851 256,34.357 271.59,48.851"/><polygon style="fill:#ea4756" points="255.997,58.347 32.335,271.885 1.062,245.63 240.403,17.693 255.997,3.206 271.591,17.693 510.931,245.63 479.657,271.885"/><rect x="107.624" y="284.421" style="fill:#c97523" width="129.567" height="224.371"/><rect x="274.808" y="284.421" style="fill:#a0d9f2" width="147.55" height="129.567"/><rect x="274.808" y="284.421" style="fill:#c97523" width="147.55" height="39.372"/><path style="fill:#8e480e" d="M211.661 403.726h-18.808c-4.329.0-7.837-3.509-7.837-7.837s3.508-7.837 7.837-7.837h18.808c4.329.0 7.837 3.509 7.837 7.837S215.99 403.726 211.661 403.726z"/><circle style="fill:#413740" cx="256" cy="184.31" r="36.047"/><g><path style="fill:#8e480e" d="M237.192 276.587H107.624c-4.329.0-7.837 3.509-7.837 7.837v224.371h15.673V292.26h113.894v216.534h15.673V284.423C245.029 280.094 241.521 276.587 237.192 276.587z"/><path style="fill:#8e480e" d="M422.354 276.587H274.808c-4.329.0-7.837 3.509-7.837 7.837v129.567c0 4.328 3.508 7.837 7.837 7.837h147.546c4.329.0 7.837-3.509 7.837-7.837V284.423C430.191 280.094 426.683 276.587 422.354 276.587zM414.517 292.26v23.698H282.645V292.26H414.517zM282.645 406.154v-74.522h131.872v74.522H282.645z"/></g><path style="fill:#ea4756" d="M256 228.192c-24.198.0-43.884-19.686-43.884-43.884s19.686-43.885 43.884-43.885 43.884 19.686 43.884 43.885c0 24.197-19.686 43.884-43.884 43.884zm0-72.095c-15.555.0-28.21 12.655-28.21 28.211.0 15.555 12.655 28.21 28.21 28.21s28.21-12.655 28.21-28.21c0-15.556-12.655-28.211-28.21-28.211z"/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/about><svg height="512pt" viewBox="0 -48 512 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m32 0h448v96H32zm0 0" fill="#168de2"/><path d="m0 64h512v352H0zm0 0" fill="#40a2e7"/><path d="m256 352v64H64v-64c0-24.640625 9.28125-47.039062 24.640625-64 17.4375-19.679688 43.039063-32 71.359375-32s53.921875 12.320312 71.359375 32C246.71875 304.960938 256 327.359375 256 352zm0 0" fill="#f9ddaa"/><path d="m288 192h160v32H288zm0 0" fill="#fff"/><path d="m448 288h-32v-32h32zm-64 0h-96v-32h96zm0 0" fill="#fff"/><path d="m231.359375 288c0 17.601562-32 32-71.359375 32s-71.359375-14.398438-71.359375-32c17.4375-19.679688 43.039063-32 71.359375-32s53.921875 12.320312 71.359375 32zm0 0" fill="#f7ce8a"/><path d="m224 224c0 35.347656-28.652344 64-64 64s-64-28.652344-64-64 28.652344-64 64-64 64 28.652344 64 64zm0 0" fill="#f9ddaa"/><g fill="#fff"><path d="m32 96h32v32H32zm0 0"/><path d="m96 96h32v32H96zm0 0"/><path d="m32 160h32v32H32zm0 0"/></g></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/categories><svg height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g fill="#57a4ff"><circle cx="128" cy="128" r="80"/><circle cx="128" cy="128" r="80"/><rect height="224" rx="20" width="224" x="272" y="16"/><rect height="224" rx="20" width="224" x="16" y="272"/><path d="m440 456H328l8-96h96z"/><path d="m440 456H328l8-96h96z"/></g><g fill="#004fac"><path d="m128 40a88 88 0 1088 88 88.1 88.1.0 00-88-88zm0 160a72 72 0 1172-72 72.081 72.081.0 01-72 72z"/><path d="m144 112a8 8 0 000-16h-8a8 8 0 00-16 0h-8a8 8 0 00-8 8v24a8 8 0 008 8h24v8h-24a8 8 0 000 16h8a8 8 0 0016 0h8a8 8 0 008-8v-24a8 8 0 00-8-8h-24v-8z"/><path d="m220 8H36A28.032 28.032.0 008 36v184a28.032 28.032.0 0028 28h184a28.032 28.032.0 0028-28V36A28.032 28.032.0 00220 8zm12 212a12.013 12.013.0 01-12 12H36a12.013 12.013.0 01-12-12V36a12.013 12.013.0 0112-12h184a12.013 12.013.0 0112 12z"/><path d="m476 8H292a28.032 28.032.0 00-28 28v184a28.032 28.032.0 0028 28h184a28.032 28.032.0 0028-28V36A28.032 28.032.0 00476 8zm12 212a12.013 12.013.0 01-12 12H292a12.013 12.013.0 01-12-12V36a12.013 12.013.0 0112-12h184a12.013 12.013.0 0112 12z"/><path d="m220 264H36A28.032 28.032.0 008 292v184a28.032 28.032.0 0028 28h184a28.032 28.032.0 0028-28V292a28.032 28.032.0 00-28-28zm12 212a12.013 12.013.0 01-12 12H36a12.013 12.013.0 01-12-12V292a12.013 12.013.0 0112-12h184a12.013 12.013.0 0112 12z"/><path d="m476 264H292a28.031 28.031.0 00-28 28v184a28.031 28.031.0 0028 28h184a28.031 28.031.0 0028-28V292a28.031 28.031.0 00-28-28zm12 212a12.01 12.01.0 01-12 12H292a12.01 12.01.0 01-12-12V292a12.01 12.01.0 0112-12h184a12.01 12.01.0 0112 12z"/><path d="m439.972 359.335A8 8 0 00432 352h-16v-12a28.032 28.032.0 00-28-28h-8a28.032 28.032.0 00-28 28v12h-16a8 8 0 00-7.972 7.335l-8 96A8 8 0 00328 464h112a8 8 0 007.972-8.665zM368 340a12.013 12.013.0 0112-12h8a12.013 12.013.0 0112 12v12h-32zm-31.306 108 6.667-80H352v8a8 8 0 0016 0v-8h32v8a8 8 0 0016 0v-8h8.639l6.667 80z"/></g></g></svg>
<span>Categories</span>
</a>
</li>
<li>
<a href=/series><svg id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m103.067 408.237h355.47v72.56h-355.47z" fill="#b2e7f1"/><path d="m417.364 512H76.588c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c17.206.0 31.204-13.998 31.204-31.204.0-17.207-13.998-31.205-31.204-31.205H76.588c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c38.21.0 69.296 31.087 69.296 69.296.0 38.211-31.086 69.297-69.296 69.297z" fill="#ffa585"/><g><path d="m417.364 373.408H355.85c31.677.0 57.449 22.543 57.449 50.251s-25.772 50.25-57.449 50.25H76.587c-10.518.0-19.045 8.527-19.045 19.046s8.527 19.046 19.046 19.046h340.776c38.21.0 69.296-31.085 69.296-69.295.0-38.211-31.086-69.298-69.296-69.298z" fill="#a7adf1"/></g><path d="m486.66 442.705c0-38.21-31.086-69.296-69.296-69.296H355.85c26.884.0 49.506 16.24 55.739 38.091h5.776c17.206.0 31.204 13.998 31.204 31.205.0 17.206-13.998 31.204-31.204 31.204H76.588c-10.519.0-19.046 8.527-19.046 19.046.0 10.518 8.527 19.045 19.046 19.045h.002 340.773c38.211.0 69.297-31.086 69.297-69.295z" fill="#ef7c85"/><path d="m103.067 269.646h355.47v72.56h-355.47z" fill="#e7effa"/><path d="m417.364 373.408H76.588c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c17.206.0 31.204-13.998 31.204-31.204.0-17.207-13.998-31.205-31.204-31.205H76.588c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c38.21.0 69.296 31.087 69.296 69.296.0 38.212-31.086 69.297-69.296 69.297z" fill="#a183e2"/><g><path d="m417.364 234.817H355.85c31.677.0 57.449 22.543 57.449 50.251s-25.772 50.249-57.449 50.249H76.587c-10.518.001-19.045 8.527-19.045 19.046s8.527 19.046 19.046 19.046h340.776c38.21.0 69.296-31.085 69.296-69.295s-31.086-69.297-69.296-69.297z" fill="#dcb6f5"/></g><path d="m417.364 234.817H355.85c26.884.0 49.506 16.24 55.739 38.091h5.776c17.206.0 31.204 13.999 31.204 31.205s-13.998 31.204-31.204 31.204H76.588c-10.519.0-19.046 8.527-19.046 19.045.0 10.519 8.527 19.045 19.046 19.045h.002 340.774c38.21.0 69.296-31.086 69.296-69.295s-31.086-69.295-69.296-69.295z" fill="#9762e2"/><path d="m49.461 131.054H404.93v72.56H49.461z" fill="#fef2a8"/><path d="m363.758 234.817H22.982c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c17.206.0 31.204-13.998 31.204-31.204.0-17.207-13.998-31.205-31.204-31.205H22.982c-10.519.0-19.046-8.527-19.046-19.046s8.527-19.046 19.046-19.046h340.776c38.21.0 69.296 31.087 69.296 69.296.0 38.211-31.086 69.297-69.296 69.297z" fill="#ef8bbd"/><g><path d="m363.758 96.225h-61.515c31.677.0 57.449 22.543 57.449 50.251s-25.772 50.25-57.449 50.25H22.981c-10.518.001-19.045 8.527-19.045 19.046s8.527 19.046 19.046 19.046h340.776c38.21.0 69.296-31.085 69.296-69.295.0-38.211-31.086-69.298-69.296-69.298z" fill="#eeb6a8"/></g><path d="m363.758 96.225h-61.514v.001c26.884.0 49.506 16.24 55.739 38.091h5.776c17.206.0 31.204 13.998 31.204 31.205.0 17.206-13.998 31.204-31.204 31.204H22.982c-10.518.0-19.046 8.527-19.046 19.045.0 10.519 8.527 19.046 19.046 19.046h.003 340.773c38.21.0 69.296-31.085 69.296-69.295s-31.086-69.297-69.296-69.297z" fill="#e068bd"/><g><path d="m206.351 171.653H54.087c-3.386.0-6.132-2.745-6.132-6.132.0-3.386 2.745-6.132 6.132-6.132h152.264c3.386.0 6.132 2.745 6.132 6.132-.001 3.386-2.746 6.132-6.132 6.132z" fill="#d08372"/></g><g><path d="m442.112 310.244H341.757c-3.386.0-6.132-2.745-6.132-6.132s2.745-6.132 6.132-6.132h100.355c3.386.0 6.132 2.745 6.132 6.132s-2.745 6.132-6.132 6.132z" fill="#ad99c9"/></g><g><path d="m299.689 310.244h-81.194c-3.386.0-6.132-2.746-6.132-6.132s2.746-6.132 6.132-6.132h81.194c3.386.0 6.132 2.746 6.132 6.132.0 3.387-2.746 6.132-6.132 6.132z" fill="#ad99c9"/></g><g><path d="m183.447 448.836h-80.38c-3.386.0-6.132-2.746-6.132-6.132s2.745-6.132 6.132-6.132h80.38c3.386.0 6.132 2.745 6.132 6.132-.001 3.387-2.746 6.132-6.132 6.132z" fill="#95cde6"/></g><g><path d="m391.935 448.836H227.196c-3.386.0-6.132-2.746-6.132-6.132s2.746-6.132 6.132-6.132h164.739c3.386.0 6.132 2.745 6.132 6.132s-2.746 6.132-6.132 6.132z" fill="#95cde6"/></g></g><g><ellipse cx="494.687" cy="159.307" fill="#a183e2" rx="8.027" ry="8.027" transform="matrix(.14 -.99 .99 .14 267.87 626.905)"/><path d="m407.989 18.973c0 4.433-3.594 8.027-8.027 8.027s-8.027-3.594-8.027-8.027 3.594-8.027 8.027-8.027 8.027 3.594 8.027 8.027z" fill="#a183e2"/><g fill="#cab4ef"><path d="m320.266 1.918 6.439 18.106c.276.775.821 1.389 1.51 1.7l16.086 7.247c2.273 1.024 2.273 4.645.0 5.669l-16.086 7.247c-.689.31-1.235.924-1.51 1.7l-6.439 18.106c-.91 2.558-4.127 2.558-5.036.0l-6.439-18.106c-.276-.775-.821-1.389-1.51-1.7l-16.086-7.247c-2.273-1.024-2.273-4.645.0-5.669l16.086-7.247c.689-.31 1.234-.925 1.51-1.7l6.439-18.106c.91-2.558 4.127-2.558 5.036.0z"/><path d="m472.695 29.586 8.848 24.408c.379 1.045 1.129 1.873 2.075 2.292l22.104 9.77c3.123 1.38 3.123 6.262.0 7.642l-22.104 9.77c-.946.418-1.696 1.246-2.075 2.291l-8.848 24.408c-1.25 3.448-5.671 3.448-6.921.0l-8.848-24.408c-.379-1.045-1.129-1.873-2.075-2.291l-22.104-9.77c-3.123-1.38-3.123-6.262.0-7.642l22.104-9.77c.947-.418 1.696-1.246 2.075-2.292l8.848-24.408c1.25-3.448 5.671-3.448 6.921.0z"/></g></g></g></svg>
<span>Series</span>
</a>
</li>
<li>
<a href=/archives><svg height="464pt" viewBox="0 -4 464.00001 464" width="464pt" xmlns="http://www.w3.org/2000/svg"><path d="m120 319.863281c0 8.839844 7.164062 16 16 16s16-7.160156 16-16" fill="#00aeef"/><path d="m152 415.863281c0 8.839844-7.164062 16-16 16s-16-7.160156-16-16c0-8.835937 7.164062-16 16-16s16 7.164063 16 16zm0 0" fill="#00aeef"/><path d="m464 223.863281c-.011719 49.902344-38.269531 91.464844-88 95.601563l-288 .398437c-23.34375.015625-45.734375-9.253906-62.238281-25.757812-16.507813-16.507813-25.7734378-38.898438-25.761719-62.242188.0-39.679687 26.238281-65.199219 62.320312-76.238281C58.121094 144.171875 55.980469 132.0625 56 119.863281c.019531-25.675781 15.375-48.859375 39.007812-58.898437 23.632813-10.039063 50.976563-4.992188 69.472657 12.820312 16.320312-53.75 72.375-84.828125 126.605469-70.195312 54.234374 14.636718 87.046874 69.691406 74.113281 124.355468.960937-.082031 1.839843-.082031 2.800781-.082031 53.019531.0 96 42.980469 96 96zm0 0" fill="#00aeef"/><path d="m376 263.863281H88v-80h288zm0 0" fill="#898890"/><path d="m152 223.863281c0 8.839844-7.164062 16-16 16s-16-7.160156-16-16c0-8.835937 7.164062-16 16-16s16 7.164063 16 16zm0 0" fill="#f1f2f2"/><path d="m376 359.863281H88v-80h288zm0 0" fill="#898890"/><path d="m152 319.863281c0 8.839844-7.164062 16-16 16s-16-7.160156-16-16c0-8.835937 7.164062-16 16-16s16 7.164063 16 16zm0 0" fill="#f1f2f2"/><path d="m376 455.863281H88v-80h288zm0 0" fill="#898890"/><g fill="#f1f2f2"><path d="m152 415.863281c0 8.839844-7.164062 16-16 16s-16-7.160156-16-16c0-8.835937 7.164062-16 16-16s16 7.164063 16 16zm0 0"/><path d="m336 199.863281h16v16h-16zm0 0"/><path d="m304 199.863281h16v16h-16zm0 0"/><path d="m272 199.863281h16v16h-16zm0 0"/><path d="m240 199.863281h16v16h-16zm0 0"/><path d="m208 199.863281h16v16h-16zm0 0"/><path d="m336 231.863281h16v16h-16zm0 0"/><path d="m304 231.863281h16v16h-16zm0 0"/><path d="m272 231.863281h16v16h-16zm0 0"/><path d="m240 231.863281h16v16h-16zm0 0"/><path d="m208 231.863281h16v16h-16zm0 0"/><path d="m176 199.863281h16v16h-16zm0 0"/><path d="m176 231.863281h16v16h-16zm0 0"/><path d="m336 295.863281h16v16h-16zm0 0"/><path d="m304 295.863281h16v16h-16zm0 0"/><path d="m272 295.863281h16v16h-16zm0 0"/><path d="m240 295.863281h16v16h-16zm0 0"/><path d="m208 295.863281h16v16h-16zm0 0"/><path d="m336 327.863281h16v16h-16zm0 0"/><path d="m304 327.863281h16v16h-16zm0 0"/><path d="m272 327.863281h16v16h-16zm0 0"/><path d="m240 327.863281h16v16h-16zm0 0"/><path d="m208 327.863281h16v16h-16zm0 0"/><path d="m176 295.863281h16v16h-16zm0 0"/><path d="m176 327.863281h16v16h-16zm0 0"/><path d="m336 391.863281h16v16h-16zm0 0"/><path d="m304 391.863281h16v16h-16zm0 0"/><path d="m272 391.863281h16v16h-16zm0 0"/><path d="m240 391.863281h16v16h-16zm0 0"/><path d="m208 391.863281h16v16h-16zm0 0"/><path d="m336 423.863281h16v16h-16zm0 0"/><path d="m304 423.863281h16v16h-16zm0 0"/><path d="m272 423.863281h16v16h-16zm0 0"/><path d="m240 423.863281h16v16h-16zm0 0"/><path d="m208 423.863281h16v16h-16zm0 0"/><path d="m176 391.863281h16v16h-16zm0 0"/><path d="m176 423.863281h16v16h-16zm0 0"/></g></svg>
<span>Archives</span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span>
</li>
</ol>
</aside>
<main class="main full-width">
<div id=article-toolbar>
<a href=https://sonlhcsuit.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/p/event-loops/>
<img src=/p/event-loops/cover_hu61a978d01b41be1072a21c5a2a854809_64775_800x0_resize_box_3.png srcset="/p/event-loops/cover_hu61a978d01b41be1072a21c5a2a854809_64775_800x0_resize_box_3.png 800w, /p/event-loops/cover_hu61a978d01b41be1072a21c5a2a854809_64775_1600x0_resize_box_3.png 1600w" width=800 height=342 loading=lazy alt="Featured image of post Event Loops">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/javascript/>
Javascript
</a>
</header>
<h2 class=article-title>
<a href=/p/event-loops/>Event Loops</a>
</h2>
<h3 class=article-subtitle>
Event loops, asynchronous and relevant concepts
</h3>
<footer class=article-time><svg id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m246.23 426.666H51.191c-18.851.0-34.132-15.282-34.132-34.132V358.4h261.957z" fill="#d3dcfb"/><path d="m460.825 153.6v143.398 95.534H51.191c-18.851.0-34.132-15.282-34.132-34.133V153.6l238.95-85.334z" fill="#ebf5fc"/><g fill="#3c58a0"><path d="m77.336 221.867H59.203c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.582 8-8 8z"/><path d="m145.603 221.867H127.47c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.582 8-8 8z"/><path d="m213.869 221.867h-18.133c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.581 8-8 8z"/><path d="m282.136 221.867h-18.133c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.582 8-8 8z"/><path d="m350.391 221.867h-18.133c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.581 8-8 8z"/><path d="m418.658 221.867h-18.133c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.418-3.582 8-8 8z"/><path d="m77.336 290.133H59.203c-4.418.0-8-3.582-8-8V264c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.419-3.582 8-8 8z"/><path d="m145.603 290.133H127.47c-4.418.0-8-3.582-8-8V264c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.419-3.582 8-8 8z"/><path d="m213.869 290.133h-18.133c-4.418.0-8-3.582-8-8V264c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8v18.133c0 4.419-3.581 8-8 8z"/><path d="m290.136 290.133v-25.6c0-4.713-3.82-8.533-8.533-8.533h-17.067c-4.713.0-8.533 3.82-8.533 8.533V281.6c0 4.713 3.821 8.533 8.533 8.533z"/><path d="m77.336 358.4H59.203c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8V350.4c0 4.418-3.582 8-8 8z"/><path d="m145.603 358.4H127.47c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8V350.4c0 4.418-3.582 8-8 8z"/><path d="m213.869 358.4h-18.133c-4.418.0-8-3.582-8-8v-18.133c0-4.418 3.582-8 8-8h18.133c4.418.0 8 3.582 8 8V350.4c0 4.418-3.581 8-8 8z"/></g><path d="m418.417 187.733h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.219 4.178 5.219 7.662v17.65c0 3.484-2.165 6.456-5.219 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.65c-.001-4.552-3.691-8.242-8.242-8.242z" fill="#2a428c"/><path d="m350.15 187.733H332.5c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.219 4.178 5.219 7.662v17.65c0 3.484-2.165 6.456-5.219 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.241-3.69 8.241-8.241v-17.65c0-4.552-3.689-8.242-8.241-8.242z" fill="#2a428c"/><path d="m281.895 187.733h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.65c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.65c-.001-4.552-3.691-8.242-8.242-8.242z" fill="#2a428c"/><path d="m213.628 187.733h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.65c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.65c-.001-4.552-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m145.361 187.733h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.219 4.178 5.219 7.662v17.65c0 3.484-2.165 6.456-5.219 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.65c0-4.552-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m77.095 187.733h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.65c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.65c-.001-4.552-3.691-8.242-8.242-8.242z" fill="#2a428c"/><path d="m77.095 256h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.651c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c-.001-4.552-3.691-8.242-8.242-8.242z" fill="#2a428c"/><path d="m77.095 324.267h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.651c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c-.001-4.553-3.691-8.242-8.242-8.242z" fill="#2a428c"/><path d="m145.361 256h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.219 4.178 5.219 7.662v17.651c0 3.484-2.165 6.456-5.219 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c0-4.552-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m145.361 324.267h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.219 4.178 5.219 7.662v17.651c0 3.484-2.165 6.456-5.219 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c0-4.553-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m213.628 256h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.651c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c-.001-4.552-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m290.136 290.133v-25.892c0-4.552-3.69-8.241-8.242-8.241h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.651c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h25.892z" fill="#2a428c"/><path d="m213.628 324.267h-17.65c-1.068.0-2.085.21-3.022.579 3.055 1.206 5.22 4.178 5.22 7.662v17.651c0 3.484-2.165 6.456-5.22 7.662.937.37 1.954.58 3.022.58h17.65c4.552.0 8.242-3.69 8.242-8.241v-17.651c-.001-4.553-3.69-8.242-8.242-8.242z" fill="#2a428c"/><path d="m437.114 143.721v153.277 95.535h23.711v-95.535V153.6z" fill="#d3dcfb"/><path d="m460.825 153.6V68.266c0-18.851-15.282-34.132-34.132-34.132H51.191c-18.851.0-34.132 15.281-34.132 34.132V153.6z" fill="#ff4155"/><g><g><g><path d="m124.609 75.993h-22.217c-4.268.0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h22.217c4.268.0 7.726 3.459 7.726 7.726s-3.459 7.726-7.726 7.726z" fill="#e80054"/></g><g><path d="m179.191 75.993h-22.217c-4.268.0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h22.217c4.268.0 7.726 3.459 7.726 7.726s-3.458 7.726-7.726 7.726z" fill="#e80054"/></g><g><path d="m320.887 75.993h-22.218c-4.268.0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h22.218c4.268.0 7.726 3.459 7.726 7.726s-3.458 7.726-7.726 7.726z" fill="#e80054"/></g><g><path d="m375.47 75.993h-22.218c-4.268.0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h22.218c4.268.0 7.726 3.459 7.726 7.726s-3.459 7.726-7.726 7.726z" fill="#e80054"/></g></g></g><path d="m162.125 64c0 11.782-9.551 21.333-21.333 21.333S119.459 75.782 119.459 64V21.333C119.458 9.551 129.009.0 140.791.0s21.333 9.551 21.333 21.333V64z" fill="#ebf5fc"/><path d="m358.403 64c0 11.782-9.551 21.333-21.333 21.333S315.736 75.782 315.736 64V21.333C315.736 9.551 325.287.0 337.069.0s21.333 9.551 21.333 21.333V64z" fill="#ebf5fc"/><path d="m337.069.0c-4.38.0-8.448 1.324-11.836 3.588 5.725 3.826 9.498 10.343 9.498 17.746V64c0 7.402-3.773 13.92-9.498 17.746 3.387 2.263 7.456 3.588 11.836 3.588 11.782.0 21.333-9.551 21.333-21.333V21.333c.001-11.782-9.55-21.333-21.333-21.333z" fill="#d3dcfb"/><path d="m140.791.0c-4.38.0-8.448 1.324-11.836 3.588 5.725 3.826 9.498 10.343 9.498 17.746V64c0 7.402-3.773 13.92-9.498 17.746 3.387 2.263 7.456 3.588 11.836 3.588 11.782.0 21.333-9.551 21.333-21.333V21.333c.001-11.782-9.55-21.333-21.333-21.333z" fill="#d3dcfb"/><path d="m426.693 34.133H402.99c18.851.0 34.132 15.281 34.132 34.132V153.6h23.702V68.266c.001-18.851-15.281-34.133-34.131-34.133z" fill="#e80054"/><path d="m17.058 111.74h443.767v15.453H17.058z" fill="#e80054"/></g><circle cx="366.942" cy="384" fill="#4fabf7" r="128"/><circle cx="366.942" cy="384" fill="#ebf5fc" r="93.867"/><g><g><path d="m366.942 374.659c-4.268.0-7.726-3.459-7.726-7.726v-42.667c0-4.267 3.459-7.726 7.726-7.726 4.268.0 7.726 3.459 7.726 7.726v42.667c0 4.267-3.459 7.726-7.726 7.726z" fill="#3c58a0"/></g></g><g><g><path d="m409.609 391.726h-25.601c-4.268.0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h25.601c4.268.0 7.726 3.459 7.726 7.726s-3.459 7.726-7.726 7.726z" fill="#3c58a0"/></g></g><path d="m366.942 256c-3.995.0-7.945.193-11.847.551C420.232 262.53 471.247 317.303 471.247 384s-51.016 121.47-116.153 127.449c3.902.358 7.852.551 11.847.551 70.692.0 128-57.308 128-128s-57.307-128-127.999-128z" fill="#1886ea"/><path d="m366.942 290.133c-4.01.0-7.961.253-11.839.741 46.252 5.821 82.028 45.295 82.028 93.126s-35.776 87.305-82.028 93.126c3.878.488 7.829.741 11.839.741 51.841.0 93.867-42.026 93.867-93.867s-42.026-93.867-93.867-93.867z" fill="#d3dcfb"/><circle cx="366.942" cy="384" fill="#ffdd40" r="17.067"/></g></svg>
<time class=article-time--published>Apr 23, 2021</time>
</footer></div>
</header>
<section class=article-content>
<p>Javascript là một ngôn ngữ lập trình duy nhất ở thời điểm hiện tại có thể chạy trên trình duyệt web ( WA - Web assembly có thể chạy trên browser, web assembly khiến cho binary code có thể chạy trên nền web). Duy nhất ở đây không phải là không thể tạo ra ngôn ngữ nào khác thay thế mà là không cần thiết vì Javascript đã quá trở nên phổ biến (ở đây tập trung nói về client-side Javascript). Javascript được thiết kế theo <strong>event-driven</strong> paradigm (Hướng sự kiện). Javascript không phải là ngôn ngữ duy nhất được thiết kế dựa trên paradigm này (Hầu hết các ngôn ngữ hỗ trợ xây dựng GUI đều hỗ trợ).</p>
<h1 id=event-driven-paradigm>Event-driven Paradigm</h1>
<p>Giống như OOP được thiết kế dựa trên các <code>Object</code> & <code>Class</code> thì event-driven programming language được thiết kế dựa trên thành phần chủ yếu là <code>Event</code> & <code>Listener</code>. Đa phần các ngôn ngữ lập trình có thể xây dựng ứng dụng (application) đều hỗ trợ paradigm (Java, C, C++, et cetera). Lưu ý rằng là application ở đây không chỉ nói riêng về các GUI ở phía client mà còn cả ở phía server, vì server cũng phải luôn lắng nghe các request từ internet (dễ dàng mở rộng, tích hợp). Các ngôn ngữ lập trình đã hỗ trợ các <strong>event</strong> built-in (click, nhập liệu, di chuyển chuột, đọc file, xoá file, et cetera).</p>
<h1 id=event-emitters--event-listeners>Event Emitters / Event Listeners</h1>
<p>Event có rất nhiều loại, tuy nhiên ta có thể khái quát lại thế giới của event-driven paradigm gồm : <code>emitters</code> & <code>listeners</code>. Một <strong>event</strong> được định nghĩa là một hành động nào đó xảy ra, khi các điều kiện phù hợp với một tiêu chuẩn nào đó , <strong>event</strong> đó sẽ <code>emit</code> ra một tín hiệu (<code>signal</code>) đến cho nhiều <code>listener</code> đang chờ đợi tín hiệu đó. Khi nhận được các tín hiệu thì các <code>listener</code> sẽ được thực thi. Thông thường <code>listener</code> là các hàm (callback) đã được khai báo sẵn, khi nhận được tín hiệu thì sẽ lập tức thực thi. Điều này cho phép ta sắp đặt các <code>listener</code> phù hợp với tương ứng với các event. Ví dụ như khi người dùng click nút <code>Mua</code> thì ta sẽ lập tức hiển thị lên thông tin về giao dịch, &mldr;</p>
<p>Ta cũng có nhiều vấn đề phát sinh như sau:</p>
<ul>
<li><strong>Event</strong> <code>emit</code> tín hiệu khi chương trình kết thúc thì như thế nào?</li>
<li>Làm sao chúng ta biết được khi nào một <strong>Event</strong> <code>emit</code> tín hiệu?</li>
<li>Lúc nhận được tín hiệu mà chúng ta đang thực hiện đoạn code khác thì sao?</li>
<li>&mldr;</li>
</ul>
<p>Thông thường đối với vấn đề thứ nhất và thứ hai, ta sẽ chọn cách giải quyết là để chương trình luôn chạy, luôn luôn khiến các <code>listener</code> ỏ trong trạng thái sẵn sàng (mặc dù đã hết phần code ở phần main) tín hiệu từ Event. Vấn đề thứ ba ta có thể sử dụng đa luồng để giải quyết.</p>
<p>Lợi ích của event-driven paradigm gồm đơn giản và dễ mở rộng. Ví dụ về vấn đề mua hàng, ta có thể mở rộng bằng cách thêm các listener đảm nhận chức năng sign up/sign in vào mà không ảnh hưởng code của việc thực hiện giao dịch (tất nhiên vẫn phải đảm bảo logic: đã đăng nhập => điền thông tin => hiển thị thông tin giao dịch), giúp chúng ta tracing (theo dấu) được các hành vi của người dùng một cách tốt hơn.</p>
<h1 id=event-loops>Event Loops</h1>
<p>Tổng kết lại, một hành động <code>listener</code> sẽ được thực thi khi một sự kiện <code>event</code> nào đó được xảy ra (không nhất thiết từ phía người dùng). Để các <code>event</code> & <code>listener</code> chạy đúng đắn (<code>event</code> này xảy ra thì <code>listener</code> này được thực hiện, et cetera) thì chương trình cần phải chạy liên tục, luôn luôn chờ <code>signal</code> từ các <code>event emitter</code> (nguồn phát tín hiệu báo sự kiện hoàn thành ) để có thể thực hiện các <code>listener</code>. <strong>Event Loops</strong> là cơ chế giúp javascript có thể luôn chờ các tín hiệu phát ra, và điều phối thứ tự thực hiện các <code>listener</code> của nhiều <code>event</code> khác nhau. Event Loops giống một đứa con nít luôn hỏi mẹ &ldquo;Mẹ ơi khi nào về?&rdquo;, chỉ khác thứ <strong>Event Loops</strong> yêu cầu là tín hiệu của bất kỳ <code>event</code>. Javascript khi nhận được <code>signal</code> từ <code>event emitter</code> sẽ tìm kiếm đến các <code>listener</code> (một hàm callback) đang lắng nghe <code>event</code> và thực hiện (execute, call, invoke) nó.</p>
<p><figure style=flex-grow:106;flex-basis:255px>
<a href=/p/event-loops/img-1.png data-size=734x689><img src=/p/event-loops/img-1.png srcset="/p/event-loops/img-1_hu38b9218ffc448345a22f3f9616787b81_25269_480x0_resize_box_3.png 480w, /p/event-loops/img-1_hu38b9218ffc448345a22f3f9616787b81_25269_1024x0_resize_box_3.png 1024w" width=734 height=689 loading=lazy alt="Event loops - client side">
</a>
<figcaption>Event loops - client side</figcaption>
</figure>
<figure style=flex-grow:241;flex-basis:579px>
<a href=/p/event-loops/img-2.png data-size=1120x464><img src=/p/event-loops/img-2.png srcset="/p/event-loops/img-2_hu819fc556566a62b34a283c94f16a21d0_18977_480x0_resize_box_3.png 480w, /p/event-loops/img-2_hu819fc556566a62b34a283c94f16a21d0_18977_1024x0_resize_box_3.png 1024w" width=1120 height=464 loading=lazy alt="Event loops - nodejs">
</a>
<figcaption>Event loops - nodejs</figcaption>
</figure></p>
<p>Điều đáng chú ý rằng javascript là một ngôn ngữ <strong>single thread</strong> (đơn luồng) dẫn tới việc javascript chỉ có 1 heap và 1 callstack (callback có thể sử dụng nhiều hàm chức năng khác nên callstack là cần thiết). Nếu nhiều <code>event</code> phát ra tín hiệu liên tiếp thì có cách giải quyết nào? Để giải quyết trường hợp này thì javascript hỗ trợ thêm khái niệm <strong>Event Queue</strong>, nhằm mục đích lưu trữ thứ tự các signal được emit từ các event khác nhau. Khi một <code>listener</code> được hoàn thành (thường là callstack trống), <strong>Event Queue</strong> sẽ lần lượt xử lý các <code>listener</code> tiếp theo.</p>
<p>Javascript lúc bình thường sẽ chạy từng dòng một từ trên xuống đồng bộ (synchronous), tuy nhiên khi các <code>event</code> phát ra <code>signal</code> thì phải được xử lý thông qua <strong>Event Queue</strong> (Từng event một sẽ được xử lý).</p>
<h1 id=webapis-and-synchronous---asynchronous>WebAPIs and Synchronous - Asynchronous</h1>
<p>Synchronous nghĩa là đồng bộ, nhằm chỉ việc code của chúng ta sẽ được thực thi theo thứ tự nhất định (từng dòng 1). Khi gặp các tao thác I/O thì code sẽ bị block (không chạy phần phía dưới) cho đến khi I/O hoàn thành (điển hình là <code>alert</code> & <code>prompt</code>). Cơ chế event queue của javascript cũng được tính vào synchronous và asynchronous.</p>
<p>Xem xét ví dụ sau đây.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btn</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#34;#btn&#34;</span>)
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>,()=&gt;{
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;clicked&#34;</span>)
})
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>click</span>() <span style=color:#75715e>// thực hiện thao tác click vào nút, thay vì đợi người dùng click
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;he?&#34;</span>)
<span style=color:#75715e>// clicked
</span><span style=color:#75715e>// he
</span><span style=color:#75715e>// listener được execute trước!
</span></code></pre></div><p>Asynchronous nghĩa là bất đồng bộ, hằm chỉ việc code của chúng ta sẽ không được thực thi theo thứ tự đã viết.
Xem xét ví dụ sau đây.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btn</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#34;#btn&#34;</span>)
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>,()=&gt;{
    <span style=color:#a6e22e>setTimeout</span>(()=&gt;{
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;clicked&#34;</span>)

    },<span style=color:#ae81ff>0</span>)
})
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>,()=&gt;{
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;clicked 2&#34;</span>)
})
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>click</span>() <span style=color:#75715e>// thực hiện thao tác click vào nút, thay vì đợi người dùng click
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;he?&#34;</span>)
<span style=color:#75715e>// clicked 2
</span><span style=color:#75715e>// he
</span><span style=color:#75715e>// clicked
</span><span style=color:#75715e>// listener được execute sau!
</span></code></pre></div><p>Lí giải tại sao ví dụ thứ 2 lại có kết quả như vậy là bởi vì có sự can thiệp của <code>Web API</code>. WebAPI hỗ trợ chúng ta nhiều thứ như <code>ajax</code>, <code>timers</code>, <code>file reader</code>, et cetera. Về mặt bản chất thì Web API cũng hoạt động dựa trên event queue, tuy nhiên hơi khác một tí là: Nếu sử dụng Web APIs thì thứ tự ưu tiên của event được emit từ Web APIs sẽ &ldquo;kém hơn&rdquo; các event, nghĩa là Event sẽ bị hoãn cho tới khi callstack trống (code của chương trình chính được chạy hoàn toàn) thì mới được đưa vào Event Queue và bắt đầu xử lý theo quy tắc của Event Queue( lấy từng Event ra -> tạo callstack mới -> execute listener).</p>
<p>Hãy thử đoạn code trên với vòng lặp for dùng để blocking khoảng 2s</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btn</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#34;#btn&#34;</span>)
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>,()=&gt;{
    <span style=color:#a6e22e>setTimeout</span>(()=&gt;{
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;clicked&#34;</span>)

    },<span style=color:#ae81ff>0</span>)
})
<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>,()=&gt;{
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;clicked 2&#34;</span>)
})

<span style=color:#a6e22e>btn</span>.<span style=color:#a6e22e>click</span>() <span style=color:#75715e>// thực hiện thao tác click vào nút, thay vì đợi người dùng click
</span><span style=color:#75715e></span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>3000000000</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
<span style=color:#75715e>// block 3s
</span><span style=color:#75715e></span>}
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;he?&#34;</span>)
<span style=color:#75715e>// clicked 2
</span><span style=color:#75715e>// Phải đợi khoảng 3s, mặc dù hàm setTimeout có thời gian đợi là 0s!
</span><span style=color:#75715e>// he
</span><span style=color:#75715e>// clicked
</span></code></pre></div><p>Những tác vụ có sử dụng Web APIs được gọi là những tác vụ asynchronous (điều ngược lại không đúng). Các tác vụ asynchronous (thường là <code>function</code>) sẽ có độ ưu tiên kém (chỉ được thêm vào event queue khi <code>callstack</code> trống lần đầu tiên - Hoàn thành hết code synchronous). Sau đó thì cũng sẽ được xử lý dưới cơ chế <strong>event queue</strong> & <strong>event loops</strong>. Sau khi đã qua hoàn thành code javascript synchronous thì mọi thứ sẽ được nhường về cho <strong>Event Loops</strong> và những thứ liên quan. Nên chú ý một chút về các <code>listener</code>, các <code>listener</code> phải được hoàn thành toàn bộ (callstack rỗng) thì event queue mới có thể đưa <code>listener</code> kế tiếp vào hoàn thành, vậy nên nếu <code>listener</code> trước chưa được hoàn thành thì phải đợi chờ đến khi được hoàn thành. Khi một listener đang chạy (tốn thời gian rất lâu) thì các interaction khác sẽ không chạy (ví dụ như <code>scroll</code>, <code>click</code>,..) cho nên đừng có làm gì quá rắc rối trong <code>listener</code> - Ví dụ như animation, đệ quy không có điểm dừng, tính số fibnacci ,&mldr; - cơ chế này có tên là &ldquo;Run to completion&rdquo;.</p>
<p>Đây cũng chính là sức mạnh của Javascript khi so sánh với các ngôn ngữ khác!</p>
<p>Tổng kết lại, <strong>event loops</strong> sẽ xem xét xem thử có bất kỳ <code>event</code> nào phát ra tín hiệu không? Nếu có thì sẽ thêm vào event queue. Nếu callstack trống, <strong>event queue</strong> sẽ xử lý từng <code>listener</code> tương ứng với signal được <code>event</code> phát ra. <strong>WebAPIs</strong> cung cấp cho chúng ta các công cụ tiện lợi(<code>timers</code>, <code>fetch</code>, <code>file reader</code>, et cetera) và hoạt động dựa vào <strong>event loops</strong>! Tuy nhiên WebAPIs bao gồm nhiều hành động asynchronous, kỹ năng xử lý hành động asynchronous rất quan trọng khi làm việc với Javascript.</p>
<p>Có một câu hỏi hay khi phỏng vấn như thế này:&ldquo;Javascript là ngôn ngữ lập trình đơn luồng hay là đa luồng? Tại sao Javascript lại là đơn luồng/ đa luồng? Nếu Javascript là đơn luồng thì tại sao tại thực hiện được nhiều tác vụ cùng một lúc (ví dụ như fetch nhiều request cùng lúc)?&rdquo;. Điều đâu tiên, javascript là ngôn ngữ đơn luồng bởi vì javascript chỉ có duy nhất một <strong>callstack</strong> và <strong>heap</strong>. Javascript không thực sự xử lý nhiều <code>request</code> cùng 1 lúc, chỉ là cơ chế Event loops của Javascript khiến cho Javascript trông như có thể xử lý nhiều hành động cùng 1 lúc (nhiều <code>event</code> có thể xảy ra cùng 1 lúc nhưng các <code>listeners</code> thì phải được giải quyết theo thứ tự). Nói về hàm <code>fetch</code>, Javascript có thể sử dụng hàm <code>fetch</code> để lấy thông tin nhiều <code>request</code> cùng lúc (<code>Promise.all</code>), tuy nhiên, fetch là <strong>WebAPIs</strong> - nghĩa là thứ thực hiện việc gọi nhiều request cùng lúc là Browser, runtime engine chứ không phải Javascript. Khi tất cả các request được hoàn thành (nhận được response) thì <strong>WebAPIs</strong> sẽ đẩy Event vào <strong>Event Queue</strong>, lúc này các <code>listeners</code> (hay là các đoạn code handle <code>promise</code>) sẽ được thực hiện lần lượt.</p>
<hr>
<h1 id=references--more-resources>References & more resources</h1>
<ul>
<li><a class=link href=https://en.wikipedia.org/wiki/Event-driven_programming target=_blank rel=noopener>https://en.wikipedia.org/wiki/Event-driven_programming</a></li>
<li><a class=link href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop target=_blank rel=noopener>https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop</a></li>
<li><a class=link href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" target=_blank rel=noopener>https://www.youtube.com/watch?v=8aGhZQkoFbQ</a></li>
<li><a class=link href=https://medium.com/@giangcoffee/event-loop-l%C3%A0-g%C3%AC-v%C3%A0-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-th%E1%BA%BF-n%C3%A0o-d52caa908090 target=_blank rel=noopener>https://medium.com/@giangcoffee/event-loop-l%C3%A0-g%C3%AC-v%C3%A0-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-th%E1%BA%BF-n%C3%A0o-d52caa908090</a></li>
</ul>
<h3 id=ps>P/S:</h3>
<p>Các đoạn code ở trên được mình chạy ở trên engine V8 của Chrome thông qua trình duyệt Brave. Có thể tuỳ thuộc vào các engine có một cách thực thi Javascript khác nhau nên có gì sai sót xin email cho mình để mình cập nhật. Xin cảm ơn!</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/event/>event</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/p/event-bubbles/>
<div class=article-image>
<img src=/p/event-bubbles/cover.00179cec61437466d61f06aec5f0d177_hud38f19311a47fb7e81e0a14471226114_599984_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key=event-bubbles data-hash="md5-ABec7GFDdGbWHwauxfDRdw==">
</div>
<div class=article-details>
<h2 class=article-title>Event Bubbling & Capturing</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2021 Sơn Lưu Blog
</section>
<section class=powerby>
Hello, I am Son <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>